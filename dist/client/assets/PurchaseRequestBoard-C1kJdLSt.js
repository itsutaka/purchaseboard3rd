import{r as l,h as N,q as Te,k as Pe,l as qe,j as e,m as be,P as ye,n as je,C as Be,M as Ne,U as Oe,T as Ve,D as ve,p as we,X as H,t as He,u as Ke}from"./vendor-BIkbSswl.js";import{u as We,f as Xe}from"./index-CP20xKAe.js";const v=({className:z=""})=>e.jsx(Ke,{size:16,className:`animate-spin ${z}`}),Qe=()=>{const z=l.useRef(null),{currentUser:s}=We(),[w,K]=l.useState([]),[le,W]=l.useState([]),[F,I]=l.useState(!0),[R,L]=l.useState(null),[$,ne]=l.useState(!1),[ie,f]=l.useState(null),[u,M]=l.useState(!1),[C,d]=l.useState(null),[y,oe]=l.useState(!1),[g,ce]=l.useState(!1),[de,T]=l.useState(null),[X,k]=l.useState(!1),[P,S]=l.useState(!1),[G,J]=l.useState(!1),[b,h]=l.useState(null),[q,Q]=l.useState(""),[Y,Z]=l.useState(""),[B,Ce]=l.useState("all"),[_,ke]=l.useState("newest"),[U,ee]=l.useState(""),[te,me]=l.useState(""),[E,ue]=l.useState(!1),[p,xe]=l.useState(null),[O,Se]=l.useState(""),[se,De]=l.useState(""),[ae,Ae]=l.useState(""),[m,j]=l.useState({title:"",description:"",requester:"",accountingCategory:""}),re={pending:{text:"待購買",color:"bg-yellow-100 text-yellow-800"},purchased:{text:"已購買",color:"bg-green-100 text-green-800"}},x=l.useCallback(async()=>{var t,n;I(!0),L(null);try{const a=await N.get("/api/requirements");if(Array.isArray(a.data)){K(a.data);const i=a.data.filter(r=>r.status==="purchased");W(i.map(r=>({id:r.id,title:r.title||r.text,requester:r.requesterName||r.requester,purchaseAmount:r.purchaseAmount,requestDate:r.createdAt,purchaseDate:r.purchaseDate,purchaserName:r.purchaserName,accountingCategory:r.accountingCategory})))}else console.error("API response for /api/requirements is not an array:",a.data),L("無法獲取採購請求：資料格式不正確。"),K([]),W([])}catch(a){console.error("Error fetching purchase requests:",a),L("無法載入採購請求。 "+(((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.message)||a.message)),K([]),W([])}finally{I(!1)}},[]);l.useEffect(()=>{I(!0);const t=Te(Pe(Xe,"requirements")),n=qe(t,a=>{console.log("Firestore listener: Detected change in requirements, re-fetching data..."),x()},a=>{console.error("Real-time listener failed: ",a),L("無法建立即時連線，資料可能不會自動更新。"),I(!1)});return()=>n()},[x]);const ze=async()=>{var t,n;if(!m.title.trim()||!m.description.trim()){alert("請填寫需求標題與詳細描述。");return}if(!s){f("您必須登入才能提交採購需求。"),alert("您必須登入才能提交採購需求。");return}ne(!0),f(null);try{const a=await s.getIdToken(),i={text:m.title.trim(),description:m.description.trim(),accountingCategory:m.accountingCategory.trim()};await N.post("/api/requirements",i,{headers:{Authorization:`Bearer ${a}`}}),j({title:"",description:"",requester:(s==null?void 0:s.displayName)||"",accountingCategory:""}),k(!1),await x()}catch(a){console.error("Error submitting request:",a),f(((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.message)||a.message||"無法提交採購需求，請再試一次。")}finally{ne(!1)}},ge=async(t,n)=>{var a,i;if(h(t),T(n),n==="purchased")d(null),Q(""),Z((s==null?void 0:s.displayName)||""),S(!0);else if(window.confirm("您確定要撤銷這次的購買紀錄嗎？相關的購買金額與日期將會被清除。")){if(!s){alert("請登入以更新狀態。"),d("請登入以更新狀態。"),h(null),T(null);return}M(!0),d(null);try{const c=await s.getIdToken(),o={status:"pending",purchaseAmount:null,purchaseDate:null,purchaserName:null,purchaserId:null};await N.put(`/api/requirements/${t}`,o,{headers:{Authorization:`Bearer ${c}`}}),await x()}catch(c){console.error("Error reverting status:",c),d(((i=(a=c.response)==null?void 0:a.data)==null?void 0:i.message)||"無法還原狀態，請再試一次。")}finally{M(!1),h(null),T(null)}}else h(null),T(null)},Re=async()=>{var t,n;if(!q||parseFloat(q)<=0){alert("請輸入有效的購買金額");return}if(!Y.trim()){alert("請輸入購買人姓名");return}if(!s){alert("請登入以確認購買。"),d("請登入以確認購買。");return}M(!0),d(null);try{const a=await s.getIdToken(),i={status:"purchased",purchaseAmount:parseFloat(q),purchaseDate:new Date().toISOString(),purchaserName:Y.trim(),purchaserId:s.uid};await N.put(`/api/requirements/${b}`,i,{headers:{Authorization:`Bearer ${a}`}}),Q(""),Z(""),S(!1),await x()}catch(a){console.error("Error confirming purchase:",a),a.response&&a.response.status===409?(alert("這個已經買好囉。畫面將會自動為您更新。"),S(!1),await x()):d(((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.message)||"無法確認購買，請再試一次。")}finally{M(!1)}},Ee=async t=>{var a,i;if(window.confirm("您確定要刪除此採購需求嗎？相關的購買記錄和留言也會一併移除。")){if(!s){alert("請登入以刪除採購需求。"),d("請登入以刪除採購需求。");return}oe(!0),h(t),d(null);try{const r=await s.getIdToken();await N.delete(`/api/requirements/${t}`,{headers:{Authorization:`Bearer ${r}`}}),await x()}catch(r){console.error("Error deleting request:",r),d(((i=(a=r.response)==null?void 0:a.data)==null?void 0:i.message)||"無法刪除採購需求，請再試一次。")}finally{oe(!1),h(null)}}},Fe=async t=>{var a,i;const n=U.trim();if(!n){alert("請輸入留言內容！");return}if(!s){alert("請登入以新增留言。"),d("請登入以新增留言。");return}ce(!0),d(null);try{const r=await s.getIdToken(),c={text:n};await N.post(`/api/requirements/${t}/comments`,c,{headers:{Authorization:`Bearer ${r}`}}),ee(""),D(),await x()}catch(r){console.error("Error adding comment:",r),d(((i=(a=r.response)==null?void 0:a.data)==null?void 0:i.message)||"無法新增留言，請再試一次。")}finally{ce(!1)}},Ie=async(t,n)=>{var i,r;if(window.confirm("您確定要刪除此則留言嗎？")){if(!s){alert("請登入以刪除留言。"),d("請登入以刪除留言。");return}d(null);try{const c=await s.getIdToken();await N.delete(`/api/requirements/${t}/comments/${n}`,{headers:{Authorization:`Bearer ${c}`}}),await x()}catch(c){console.error("Error deleting comment:",c),d(((r=(i=c.response)==null?void 0:i.data)==null?void 0:r.message)||"無法刪除留言，請再試一次。")}}},Le=l.useCallback(t=>{xe(t),ue(!0),ee(""),me((s==null?void 0:s.displayName)||""),d(null)},[s]),D=l.useCallback(()=>{ue(!1),xe(null),d(null)},[]);l.useEffect(()=>{const t=n=>{n.key==="Escape"&&(E&&D(),X&&(k(!1),f(null)),P&&(S(!1),d(null),h(null)),G&&J(!1))};return document.addEventListener("keydown",t),E&&z.current&&!te&&!(s!=null&&s.displayName)&&z.current.focus(),()=>document.removeEventListener("keydown",t)},[E,X,P,G,D,te,s]);const $e=()=>{if(A.length===0){alert("沒有可匯出的購買記錄。");return}const t=o=>`"${String(o??"").replace(/"/g,'""')}"`;let a="\uFEFF"+["ID","項目名稱","提出者","購買金額","需求日期","購買日期","購買人","會計類別"].map(t).join(",")+`\r
`;A.forEach(o=>{const V=[o.id,o.title,o.requester,o.purchaseAmount,o.requestDate?new Date(o.requestDate).toLocaleDateString():"",o.purchaseDate?new Date(o.purchaseDate).toLocaleDateString():"",o.purchaserName||"",o.accountingCategory||""];a+=V.map(t).join(",")+`\r
`});const i=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),c=document.createElement("a");c.setAttribute("href",r),c.setAttribute("download","purchase-records.csv"),document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)},he=l.useMemo(()=>w.filter(t=>B==="all"||t.status===B),[w,B]),Me=l.useMemo(()=>[...he].sort((t,n)=>{const a=new Date(t.createdAt||0),i=new Date(n.createdAt||0);return _==="newest"?i-a:a-i}),[he,_]),A=l.useMemo(()=>le.filter(t=>{var V;const n=O?(V=t.purchaserName)==null?void 0:V.toLowerCase().includes(O.toLowerCase()):!0;let a=null;try{a=new Date(t.purchaseDate),isNaN(a.getTime())&&(a=null)}catch{a=null}let i=null;try{i=new Date(se),isNaN(i.getTime())&&(i=null)}catch{i=null}let r=null;try{r=new Date(ae),isNaN(r.getTime())&&(r=null)}catch{r=null}const c=i&&a?a>=i:!0,o=r&&a?a<=r:!0;return n&&c&&o}),[le,O,se,ae]),pe=C&&!P&&!E||R&&w.length>0&&!F?C||R:null;return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"採購需求告示牌"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>J(!0),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[" ",e.jsx(be,{size:20})," 購買記錄 "]}),e.jsxs("button",{onClick:()=>{f(null),j({title:"",description:"",requester:(s==null?void 0:s.displayName)||"",accountingCategory:""}),k(!0)},className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[" ",e.jsx(ye,{size:20})," 新增需求 "]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[" ",e.jsx("span",{className:"text-gray-700 font-medium",children:"篩選："})," ",["all","pending","purchased"].map(t=>{var n;return e.jsxs("button",{onClick:()=>Ce(t),className:`px-4 py-2 rounded-full text-sm transition-colors ${B===t?"bg-blue-500 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:[" ",t==="all"?"全部":((n=re[t])==null?void 0:n.text)||t," "]},t)})," "]}),e.jsxs("div",{className:"flex items-center gap-2",children:[" ",e.jsx("span",{className:"text-gray-700 font-medium",children:"排序："})," ",e.jsxs("select",{value:_,onChange:t=>ke(t.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[" ",e.jsx("option",{value:"newest",children:"最新建立"})," ",e.jsx("option",{value:"oldest",children:"最舊建立"})," "]})," "]})]})]}),pe&&e.jsxs("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"發生錯誤"}),e.jsx("p",{children:pe})]}),F&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx(v,{className:"text-blue-500 h-12 w-12 mx-auto"}),e.jsx("p",{className:"text-xl mt-4 text-gray-700",children:"載入需求中..."})]}),!F&&R&&w.length===0&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-6 my-6 rounded-md shadow text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"fill-current h-16 w-16 text-red-500 mb-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zM9 5v6h2V5H9zm0 8v2h2v-2H9z"})}),e.jsx("p",{className:"text-xl font-semibold text-red-700",children:"錯誤：無法載入採購需求"}),e.jsx("p",{className:"text-md text-red-600 mt-1 mb-4",children:R}),e.jsxs("button",{onClick:x,className:"px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(je,{size:16}),"重新嘗試"]})]})}),!F&&!R&&w.length===0&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),e.jsx("h3",{className:"mt-2 text-xl font-medium text-gray-900",children:"目前沒有任何採購需求"}),e.jsx("p",{className:"mt-1 text-base text-gray-500",children:"點擊「新增需求」按鈕來建立您的第一個採購單吧！"}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",onClick:()=>{f(null),j({title:"",description:"",requester:(s==null?void 0:s.displayName)||"",accountingCategory:""}),k(!0)},className:"inline-flex items-center px-6 py-3 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(ye,{size:20,className:"-ml-1 mr-2 h-5 w-5"}),"新增需求"]})})]}),w.length>0&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Me.map(t=>{var n,a,i,r,c;return e.jsxs("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden transition-opacity ${(u||y)&&b===t.id?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"p-4 pb-0",children:[" ",e.jsxs("span",{className:`inline-flex px-3 py-1 rounded-full text-sm font-medium ${((n=re[t.status])==null?void 0:n.color)||"bg-gray-100 text-gray-800"}`,children:[" ",((a=re[t.status])==null?void 0:a.text)||t.status," "]})," "]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title||t.text}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-3 h-12",children:t.description})," ",e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[" ",e.jsx(Be,{size:16})," ",e.jsx("span",{children:new Date(t.createdAt).toLocaleDateString()})," "]}),((i=t.comments)==null?void 0:i.length)>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[" ",e.jsx(Ne,{size:16})," ",e.jsx("span",{children:t.comments.length})," "]})]}),t.requesterName&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600 mb-2",children:[" ",e.jsx(Oe,{size:16})," ",e.jsxs("span",{children:["提出者：",t.requesterName]})," "]}),t.accountingCategory&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600 mb-4",children:[" ",e.jsx(Ve,{size:16,className:"text-gray-500"})," ",e.jsxs("span",{children:["會計類別：",t.accountingCategory]})," "]}),t.status==="purchased"&&t.purchaseAmount&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[" ",e.jsx(ve,{size:16})," ",e.jsxs("span",{className:"font-medium",children:["購買金額：NT$ ",t.purchaseAmount.toLocaleString()]})," "]})," ",e.jsxs("div",{className:"text-sm text-green-600 mt-1",children:[" 購買日期：",t.purchaseDate?new Date(t.purchaseDate).toLocaleDateString():"N/A"," "]})," ",t.purchaserName&&e.jsxs("div",{className:"text-sm text-green-600 mt-1",children:[" 購買人：",t.purchaserName," "]})," "]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>Le(t),className:"flex items-center gap-1 px-3 py-1 text-blue-600 hover:bg-blue-50 rounded transition-colors text-sm",disabled:y||u||g,children:[" ",e.jsx(Ne,{size:16})," 留言 (",((r=t.comments)==null?void 0:r.length)||0,") "]}),t.status==="pending"&&e.jsxs("button",{onClick:()=>ge(t.id,"purchased"),className:"flex items-center gap-1 px-3 py-1 text-green-600 hover:bg-green-50 rounded transition-colors text-sm disabled:opacity-50",disabled:u&&b===t.id||y||g,children:[" ",u&&b===t.id&&de==="purchased"?e.jsx(v,{}):"✓"," 標記為已購買 "]}),t.status==="purchased"&&e.jsxs("button",{onClick:()=>ge(t.id,"pending"),className:"flex items-center gap-1 px-3 py-1 text-orange-600 hover:bg-orange-50 rounded transition-colors text-sm disabled:opacity-50",disabled:u&&b===t.id||y||g,children:[" ",u&&b===t.id&&de==="pending"?e.jsx(v,{}):e.jsx(je,{size:16}),"撤銷購買 "]}),e.jsxs("button",{onClick:()=>Ee(t.id),className:"flex items-center gap-1 px-3 py-1 text-red-600 hover:bg-red-50 rounded transition-colors text-sm ml-auto disabled:opacity-50",disabled:y&&b===t.id||u||g,children:[" ",y&&b===t.id?e.jsx(v,{}):e.jsx(we,{size:16}),"刪除 "]})]}),((c=t.comments)==null?void 0:c.length)>0&&e.jsxs("div",{className:"border-t pt-3 mt-3",children:[" ",e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"留言列表："})," ",e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[" ",t.comments.map(o=>e.jsxs("div",{className:"bg-gray-50 rounded p-2 group relative",children:[" ",e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[" ",e.jsxs("div",{children:[" ",e.jsx("span",{className:"font-medium text-sm text-gray-900",children:o.authorName||o.userId})," ",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:new Date(o.createdAt).toLocaleString()})," "]})," ",s&&o.userId===s.uid&&e.jsxs("button",{onClick:()=>Ie(t.id,o.id),className:"text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1 -mr-1 -mt-1",title:"刪除留言",disabled:y||u||g,children:[" ",e.jsx(we,{size:14})," "]})," "]})," ",e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:o.text})," "]},o.id))," "]})," "]})]})]},t.id)})}),X&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[" ",e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[" ",e.jsxs("div",{className:"bg-blue-500 text-white p-4 rounded-t-lg flex justify-between items-center",children:[" ",e.jsx("h2",{className:"text-lg font-semibold",children:"新增採購需求"})," ",e.jsxs("button",{onClick:()=>{k(!1),f(null)},className:"text-white hover:bg-blue-600 p-1 rounded-full transition-colors",children:[" ",e.jsx(H,{size:20})," "]})," "]})," ",e.jsxs("div",{className:"p-6 space-y-4",children:[" ",ie&&e.jsxs("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[" ",e.jsx("strong",{className:"font-bold",children:"提交錯誤!"})," ",e.jsxs("span",{className:"block sm:inline",children:[" ",ie]})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"formTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:" 需求標題* "})," ",e.jsx("input",{id:"formTitle",type:"text",value:m.title,onChange:t=>j({...m,title:t.target.value}),placeholder:"請輸入標題...",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"formDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:" 詳細描述* "})," ",e.jsx("textarea",{id:"formDescription",value:m.description,onChange:t=>j({...m,description:t.target.value}),placeholder:"請描述需求的詳細內容...",rows:"4",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"formRequester",className:"block text-sm font-medium text-gray-700 mb-2",children:" 提出者姓名 "})," ",e.jsx("input",{id:"formRequester",type:"text",value:(s==null?void 0:s.displayName)||m.requester,onChange:t=>!(s!=null&&s.displayName)&&j({...m,requester:t.target.value}),placeholder:"您的姓名",className:`w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${s!=null&&s.displayName?"bg-gray-100":""}`,readOnly:!!(s!=null&&s.displayName)})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"formAccounting",className:"block text-sm font-medium text-gray-700 mb-2",children:" 會計類別 (選填) "})," ",e.jsx("input",{id:"formAccounting",type:"text",value:m.accountingCategory,onChange:t=>j({...m,accountingCategory:t.target.value}),placeholder:"請輸入會計科目或類別...",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})," "]})," ",e.jsxs("div",{className:"flex gap-3 pt-4",children:[" ",e.jsx("button",{type:"button",onClick:()=>{k(!1),f(null)},className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors",disabled:$,children:" 取消 "})," ",e.jsxs("button",{type:"button",onClick:ze,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",disabled:$,children:[" ",$&&e.jsx(v,{})," ",$?"提交中...":"提交需求"," "]})," "]})," "]})," "]})," "]}),P&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[" ",e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[" ",e.jsxs("div",{className:"bg-green-500 text-white p-4 rounded-t-lg flex justify-between items-center",children:[" ",e.jsx("h2",{className:"text-lg font-semibold",children:"確認購買"})," ",e.jsxs("button",{onClick:()=>{S(!1),d(null),h(null)},className:"text-white hover:bg-green-600 p-1 rounded-full transition-colors",children:[" ",e.jsx(H,{size:20})," "]})," "]})," ",e.jsxs("div",{className:"p-6",children:[" ",C&&e.jsx("p",{className:"text-red-500 text-sm mb-3 bg-red-100 p-2 rounded text-center",children:C})," ",e.jsx("p",{className:"text-gray-700 mb-4",children:" 請輸入購買金額與購買人以完成採購： "})," ",e.jsxs("div",{className:"mb-4",children:[" ",e.jsx("label",{htmlFor:"purchaseAmount",className:"block text-sm font-medium text-gray-700 mb-2",children:" 購買金額 (NT$)* "})," ",e.jsx("input",{id:"purchaseAmount",type:"number",value:q,onChange:t=>Q(t.target.value),placeholder:"請輸入金額...",min:"0",step:"1",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"})," "]})," ",e.jsxs("div",{className:"mb-6",children:[" ",e.jsx("label",{htmlFor:"purchaserName",className:"block text-sm font-medium text-gray-700 mb-2",children:" 購買人* "})," ",e.jsx("input",{id:"purchaserName",type:"text",value:Y,onChange:t=>Z(t.target.value),placeholder:"請輸入購買人姓名...",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"})," "]})," ",e.jsxs("div",{className:"flex gap-3",children:[" ",e.jsx("button",{type:"button",onClick:()=>{S(!1),d(null),h(null)},className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors",disabled:u,children:" 取消 "})," ",e.jsxs("button",{type:"button",onClick:Re,className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",disabled:u,children:[" ",u&&e.jsx(v,{})," ",u?"處理中...":"確認購買"," "]})," "]})," "]})," "]})," "]}),G&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[" ",e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col",children:[" ",e.jsxs("div",{className:"bg-green-500 text-white p-4 rounded-t-lg flex justify-between items-center",children:[" ",e.jsx("h2",{className:"text-lg font-semibold",children:"購買記錄"})," ",e.jsxs("div",{className:"flex items-center gap-3",children:[" ",e.jsxs("button",{onClick:$e,className:"flex items-center gap-2 bg-white text-green-700 hover:bg-gray-100 py-2 px-3 rounded-md text-sm font-medium transition-colors",title:"匯出目前篩選的記錄為 CSV",children:[" ",e.jsx(He,{size:18})," 匯出 CSV "]})," ",e.jsxs("button",{onClick:()=>J(!1),className:"text-white hover:bg-green-600 p-1 rounded-full transition-colors",title:"關閉",children:[" ",e.jsx(H,{size:20})," "]})," "]})," "]})," ",e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow",children:[" ",e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[" ",e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"篩選條件"})," ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[" ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"filterPurchaser",className:"block text-sm font-medium text-gray-700 mb-1",children:"購買人"})," ",e.jsx("input",{id:"filterPurchaser",type:"text",placeholder:"依購買人篩選...",value:O,onChange:t=>Se(t.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"filterSDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"購買日期 (起)"})," ",e.jsx("input",{id:"filterSDate",type:"date",value:se,onChange:t=>De(t.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"filterEDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"購買日期 (迄)"})," ",e.jsx("input",{id:"filterEDate",type:"date",value:ae,onChange:t=>Ae(t.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"})," "]})," "]})," "]})," ",A.length===0?e.jsxs("div",{className:"text-center py-8",children:[" ",e.jsx(be,{size:48,className:"mx-auto text-gray-400 mb-4"})," ",e.jsx("p",{className:"text-gray-500",children:"無符合條件的購買記錄"})," "]}):e.jsxs("div",{className:"space-y-4",children:[" ",e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-green-800 mb-2",children:[" ",e.jsx(ve,{size:20})," ",e.jsxs("span",{className:"font-semibold",children:["總支出金額：NT$ ",A.reduce((t,n)=>t+(n.purchaseAmount||0),0).toLocaleString()]})," "]})," ",e.jsxs("p",{className:"text-sm text-green-600",children:["共 ",A.length," 筆購買記錄"]})," "]})," ",A.map(t=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[" ",e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[" ",e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.title})," ",e.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:" 已購買 "})," "]})," ",e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[" ",e.jsxs("div",{children:[" ",e.jsx("span",{className:"text-gray-600",children:"提出者："})," ",e.jsx("span",{className:"font-medium",children:t.requester})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("span",{className:"text-gray-600",children:"購買金額："})," ",e.jsxs("span",{className:"font-medium text-green-600",children:["NT$ ",(t.purchaseAmount||0).toLocaleString()]})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("span",{className:"text-gray-600",children:"需求日期："})," ",e.jsx("span",{className:"font-medium",children:t.requestDate?new Date(t.requestDate).toLocaleDateString():"N/A"})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("span",{className:"text-gray-600",children:"購買日期："})," ",e.jsx("span",{className:"font-medium",children:t.purchaseDate?new Date(t.purchaseDate).toLocaleDateString():"N/A"})," "]})," ",t.purchaserName&&e.jsxs("div",{className:"sm:col-span-2",children:[" ",e.jsx("span",{className:"text-gray-600",children:"購買人："})," ",e.jsx("span",{className:"font-medium",children:t.purchaserName})," "]})," ",t.accountingCategory&&e.jsxs("div",{className:"sm:col-span-2",children:[" ",e.jsx("span",{className:"text-gray-600",children:"會計類別："})," ",e.jsx("span",{className:"font-medium",children:t.accountingCategory})," "]})," "]})," "]},t.id))," "]})," "]})," "]})," "]}),E&&p&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 transition-opacity duration-300 ease-in-out",onClick:D,children:[" ",e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4 transform transition-all duration-300 ease-in-out scale-100",onClick:t=>t.stopPropagation(),children:[" ",e.jsxs("div",{className:"flex justify-between items-center",children:[" ",e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:[" 發表留言於：",e.jsx("span",{className:"font-bold truncate max-w-xs inline-block align-bottom",children:(p==null?void 0:p.title)||(p==null?void 0:p.text)||"需求"})," "]})," ",e.jsxs("button",{onClick:D,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full transition-colors",title:"關閉",children:[" ",e.jsx(H,{size:24})," "]})," "]})," ",C&&e.jsx("p",{className:"text-red-500 text-sm mb-2 bg-red-100 p-2 rounded text-center",children:C})," ",e.jsxs("div",{className:"space-y-4",children:[" ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"commenterNameModal",className:"block text-sm font-medium text-gray-700 mb-1",children:"您的姓名*"})," ",e.jsx("input",{id:"commenterNameModal",ref:z,type:"text",value:te,onChange:t=>me(t.target.value),placeholder:"請輸入您的姓名...",className:`w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${s!=null&&s.displayName?"bg-gray-100":""}`,readOnly:!!(s!=null&&s.displayName)})," "]})," ",e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"newCommentModal",className:"block text-sm font-medium text-gray-700 mb-1",children:"留言內容*"})," ",e.jsx("textarea",{id:"newCommentModal",value:U,onChange:t=>ee(t.target.value),placeholder:"請輸入留言內容...",rows:"4",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})," "]})," "]})," ",e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 mt-4",children:[" ",e.jsx("button",{type:"button",onClick:D,className:"bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg transition-colors text-sm font-medium",disabled:g,children:" 取消 "})," ",e.jsxs("button",{type:"button",onClick:()=>{p&&Fe(p.id)},className:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors text-sm font-medium flex items-center justify-center gap-2 disabled:opacity-50",disabled:g||!U.trim(),children:[" ",g&&e.jsx(v,{})," ",g?"傳送中...":"送出留言"," "]})," "]})," "]})," "]})]})})};export{Qe as default};
